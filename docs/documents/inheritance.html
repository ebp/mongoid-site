<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <meta content='A Ruby ODM for MongoDB' name='description' />
    <meta content='mongoid, mongodb, ruby, rails, odm, durran jordan' name='keywords' />
    <link href="/mongoid-site/stylesheets/coderay.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="/mongoid-site/stylesheets/site.css" media="screen" rel="stylesheet" type="text/css" />
    <title>Mongoid: Documents [Inheritance]</title>
  </head>
  <body>
    <div id='container'>
      <div class='navigation'>
            <a href="#"><img src="/mongoid-site/images/mongoid-logo-small.png" />
            </a>
            
            <ul class='navigation'>
              <li class='area'><a class="area" href="/mongoid-site/">home</a></li>
              <li class='area'><a class="area" href="/mongoid-site/docs.html">docs</a></li>
              <li><a class="section" href="/mongoid-site/docs/installation.html">installation</a></li>
              <li><a class="section" href="/mongoid-site/docs/documents.html">documents</a></li>
              <li><a class="subsection" href="/mongoid-site/docs/documents/fields.html">fields</a></li>
              <li><a class="subsection" href="/mongoid-site/docs/documents/dynamic.html">dynamic fields</a></li>
              <li><a class="subsection" href="/mongoid-site/docs/documents/localized.html">localization</a></li>
              <li><a class="subsection" href="/mongoid-site/docs/documents/access.html">access</a></li>
              <li><a class="subsection" href="/mongoid-site/docs/documents/dirty.html">dirty tracking</a></li>
              <li><a class="subsection active" href="/mongoid-site/docs/documents/inheritance.html">inheritance</a></li>
              <li><a class="section" href="/mongoid-site/docs/persistence.html">persistence</a></li>
              <li><a class="section" href="/mongoid-site/docs/querying.html">querying</a></li>
              <li><a class="section" href="/mongoid-site/docs/relations.html">relations</a></li>
              <li><a class="section" href="/mongoid-site/docs/identity_map.html">identity map</a></li>
              <li><a class="section" href="/mongoid-site/docs/callbacks.html">callbacks</a></li>
              <li><a class="section" href="/mongoid-site/docs/validation.html">validation</a></li>
              <li><a class="section" href="/mongoid-site/docs/indexing.html">indexing</a></li>
              <li><a class="section" href="/mongoid-site/docs/extras.html">extras</a></li>
              <li><a class="section" href="/mongoid-site/docs/rails.html">rails</a></li>
              <li><a class="section" href="/mongoid-site/docs/extensions.html">extensions</a></li>
              <li><a class="section" href="/mongoid-site/docs/upgrading.html">upgrading</a></li>
              <li><a class="section" href="/mongoid-site/docs/contributing.html">contributing</a></li>
              <li class='area'><a class="area" href="/mongoid-site/performance.html">performance</a></li>
              <li class='area'><a class="area" href="/mongoid-site/credits.html">credits</a></li>
              <li class='area'><a class="area" href="/mongoid-site/links.html">links</a></li>
            </ul>
          </div>
      <div class='main'>
        <div class='header'>
              <a href="http://twitter.com/mongoid/"><img src="/mongoid-site/images/twitter-logo.png" />
              </a>
              <a href="http://github.com/mongoid/"><img src="/mongoid-site/images/github-logo.png" />
              </a>
            </div>
        <div class='content'>
              <h1>inheritance</h1>
              <p>
                Mongoid supports inheritance in both root and embedded documents. In
                scenarios where documents are inherited from their fields, relations,
                validations and scopes get copied down into their child documents, but
                not vise-versa.
              </p>
              <div class="CodeRay">
                <div class="code"><pre><span class="keyword">class</span> <span class="class">Canvas</span>&#x000A;  include <span class="constant">Mongoid</span>::<span class="constant">Document</span>&#x000A;  field <span class="symbol">:name</span>, <span class="key">type</span>: <span class="constant">String</span>&#x000A;  embeds_many <span class="symbol">:shapes</span>&#x000A;<span class="keyword">end</span>&#x000A;&#x000A;<span class="keyword">class</span> <span class="class">Browser</span> &lt; <span class="constant">Canvas</span>&#x000A;  field <span class="symbol">:version</span>, <span class="key">type</span>: <span class="constant">Integer</span>&#x000A;  scope <span class="symbol">:recent</span>, where(<span class="symbol">:version</span>.gt =&gt; <span class="integer">3</span>)&#x000A;<span class="keyword">end</span>&#x000A;&#x000A;<span class="keyword">class</span> <span class="class">Firefox</span> &lt; <span class="constant">Browser</span>&#x000A;<span class="keyword">end</span>&#x000A;&#x000A;<span class="keyword">class</span> <span class="class">Shape</span>&#x000A;  include <span class="constant">Mongoid</span>::<span class="constant">Document</span>&#x000A;  field <span class="symbol">:x</span>, <span class="key">type</span>: <span class="constant">Integer</span>&#x000A;  field <span class="symbol">:y</span>, <span class="key">type</span>: <span class="constant">Integer</span>&#x000A;  embedded_in <span class="symbol">:canvas</span>&#x000A;<span class="keyword">end</span>&#x000A;&#x000A;<span class="keyword">class</span> <span class="class">Circle</span> &lt; <span class="constant">Shape</span>&#x000A;  field <span class="symbol">:radius</span>, <span class="key">type</span>: <span class="constant">Float</span>&#x000A;<span class="keyword">end</span>&#x000A;&#x000A;<span class="keyword">class</span> <span class="class">Rectangle</span> &lt; <span class="constant">Shape</span>&#x000A;  field <span class="symbol">:width</span>, <span class="key">type</span>: <span class="constant">Float</span>&#x000A;  field <span class="symbol">:height</span>, <span class="key">type</span>: <span class="constant">Float</span>&#x000A;<span class="keyword">end</span>&#x000A;</pre></div>
              </div>
              <p>
                In the above example, <tt>Canvas</tt>, <tt>Browser</tt> and
                <tt>Firefox</tt> will all save in the <tt>canvases</tt> collection.
                An additional attribute <tt>_type</tt> is stored in order
                to make sure when loaded from the database the correct document is
                returned. This also holds true for the embedded documents <tt>Circle</tt>,
                <tt>Rectangle</tt>, and <tt>Shape</tt>.
              </p>
              <h3>querying for subclasses</h3>
              <p>
                Querying for subclasses is handled in the normal manner, and although
                the documents are all in the same collection, queries will only return
                documents of the correct type, similar to Single Table Inheritance in
                ActiveRecord.
              </p>
              <div class="CodeRay">
                <div class="code"><pre><span class="comment"># Returns Canvas documents and subclasses</span>&#x000A;<span class="constant">Canvas</span>.where(<span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Paper</span><span class="delimiter">&quot;</span></span>)&#x000A;<span class="comment"># Returns only Firefox documents</span>&#x000A;<span class="constant">Firefox</span>.where(<span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Window 1</span><span class="delimiter">&quot;</span></span>)&#x000A;</pre></div>
              </div>
              <h3>associations</h3>
              <p>
                You can add any type of subclass to a has one or has many association,
                through either normal setting or through the build and create methods
                on the association:
              </p>
              <div class="CodeRay">
                <div class="code"><pre>firefox = <span class="constant">Firefox</span>.new&#x000A;<span class="comment"># Builds a Shape object</span>&#x000A;firefox.shapes.build({ <span class="key">x</span>: <span class="integer">0</span>, <span class="key">y</span>: <span class="integer">0</span> })&#x000A;<span class="comment"># Builds a Circle object</span>&#x000A;firefox.shapes.build({ <span class="key">x</span>: <span class="integer">0</span>, <span class="key">y</span>: <span class="integer">0</span> }, <span class="constant">Circle</span>)&#x000A;<span class="comment"># Creates a Rectangle object</span>&#x000A;firefox.shapes.create({ <span class="key">x</span>: <span class="integer">0</span>, <span class="key">y</span>: <span class="integer">0</span> }, <span class="constant">Rectangle</span>)&#x000A;&#x000A;rect = <span class="constant">Rectangle</span>.new(<span class="key">width</span>: <span class="integer">100</span>, <span class="key">height</span>: <span class="integer">200</span>)&#x000A;firefox.shapes</pre></div>
              </div>
            </div>
        <div class='footer'>
              Mongoid, 2009-2011, written and maintained by
              <a href="http://github.com/durran">Durran Jordan</a>.
            </div>
        <div class='clear'></div>
      </div>
    </div>
  </body>
</html>
