<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <meta content='A Ruby ODM for MongoDB' name='description' />
    <meta content='mongoid, mongodb, ruby, rails, odm, durran jordan' name='keywords' />
    <link href="/mongoid-site/stylesheets/coderay.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="/mongoid-site/stylesheets/site.css" media="screen" rel="stylesheet" type="text/css" />
    <title>Mongoid: Persistence [Safe Mode]</title>
  </head>
  <body>
    <div id='container'>
      <div class='navigation'>
            <a href="#"><img src="/mongoid-site/images/mongoid-logo-small.png" />
            </a>
            
            <ul class='navigation'>
              <li class='area'><a class="area" href="/mongoid-site/">home</a></li>
              <li class='area'><a class="area" href="/mongoid-site/docs.html">docs</a></li>
              <li><a class="section" href="/mongoid-site/docs/installation.html">installation</a></li>
              <li><a class="section" href="/mongoid-site/docs/documents.html">documents</a></li>
              <li><a class="section" href="/mongoid-site/docs/persistence.html">persistence</a></li>
              <li><a class="subsection" href="/mongoid-site/docs/persistence/standard.html">standard</a></li>
              <li><a class="subsection" href="/mongoid-site/docs/persistence/atomic.html">atomic</a></li>
              <li><a class="subsection active" href="/mongoid-site/docs/persistence/safe_mode.html">safe mode</a></li>
              <li><a class="section" href="/mongoid-site/docs/querying.html">querying</a></li>
              <li><a class="section" href="/mongoid-site/docs/relations.html">relations</a></li>
              <li><a class="section" href="/mongoid-site/docs/identity_map.html">identity map</a></li>
              <li><a class="section" href="/mongoid-site/docs/callbacks.html">callbacks</a></li>
              <li><a class="section" href="/mongoid-site/docs/validation.html">validation</a></li>
              <li><a class="section" href="/mongoid-site/docs/indexing.html">indexing</a></li>
              <li><a class="section" href="/mongoid-site/docs/extras.html">extras</a></li>
              <li><a class="section" href="/mongoid-site/docs/rails.html">rails</a></li>
              <li><a class="section" href="/mongoid-site/docs/extensions.html">extensions</a></li>
              <li><a class="section" href="/mongoid-site/docs/upgrading.html">upgrading</a></li>
              <li><a class="section" href="/mongoid-site/docs/contributing.html">contributing</a></li>
              <li class='area'><a class="area" href="/mongoid-site/performance.html">performance</a></li>
              <li class='area'><a class="area" href="/mongoid-site/credits.html">credits</a></li>
              <li class='area'><a class="area" href="/mongoid-site/links.html">links</a></li>
            </ul>
          </div>
      <div class='main'>
        <div class='header'>
              <a href="http://twitter.com/mongoid/"><img src="/mongoid-site/images/twitter-logo.png" />
              </a>
              <a href="http://github.com/mongoid/"><img src="/mongoid-site/images/github-logo.png" />
              </a>
            </div>
        <div class='content'>
              <h1>safe mode</h1>
              <p>
                For cases when you want to persist with or without safe mode on a per-query
                basis you can use Mongoid's provided <tt>#safely</tt> and <tt>#unsafely</tt>
                methods. These can be prepended to any persistence operation Mongoid
                provides.
              </p>
              <h2>persisting in safe mode</h2>
              <p>
                When you are using the default configuration settings and Mongoid's
                <tt>persist_in_safe_mode</tt> option is false, you may persist a single
                operation in safe mode by overriding it with <tt>#safely</tt>.
              </p>
              <p>
                Using safely, you can have the following options:
              </p>
              <ul>
                <li><tt>fsync</tt>: Whether to perform an fsync.</li>
                <li><tt>w</tt>: The number of nodes to write to before returning.</li>
                <li><tt>wtimeout</tt>: The timeout value for writing to multiple nodes.</li>
              </ul>
              <div class="CodeRay">
                <div class="code"><pre><span class="constant">Person</span>.safely.create(<span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Bond</span><span class="delimiter">&quot;</span></span>)&#x000A;<span class="constant">Person</span>.safely(<span class="key">w</span>: <span class="integer">3</span>).create!(<span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">James</span><span class="delimiter">&quot;</span></span>)&#x000A;person.safely.save&#x000A;person.safely(<span class="key">fsync</span>: <span class="predefined-constant">true</span>).save!&#x000A;person.safely(<span class="key">w</span>: <span class="integer">2</span>, <span class="key">wtimeout</span>: <span class="integer">5000</span>).update_attributes(<span class="key">title</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Sir</span><span class="delimiter">&quot;</span></span>)&#x000A;person.safely.update_attributes!(<span class="key">title</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Madam</span><span class="delimiter">&quot;</span></span>)&#x000A;</pre></div>
              </div>
              <h2>persisting without safe mode</h2>
              <p>
                When you override the default configuration settings and Mongoid's
                <tt>persist_in_safe_mode</tt> option is true, you may persist a single
                operation without safe mode by overriding it with <tt>#unsafely</tt>.
              </p>
              <div class="CodeRay">
                <div class="code"><pre><span class="constant">Person</span>.unsafely.create(<span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Bond</span><span class="delimiter">&quot;</span></span>)&#x000A;<span class="constant">Person</span>.unsafely.create!(<span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">James</span><span class="delimiter">&quot;</span></span>)&#x000A;person.unsafely.save&#x000A;person.unsafely.save!&#x000A;person.unsafely.update_attributes(<span class="key">title</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Sir</span><span class="delimiter">&quot;</span></span>)&#x000A;person.unsafely.update_attributes!(<span class="key">title</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Madam</span><span class="delimiter">&quot;</span></span>)</pre></div>
              </div>
            </div>
        <div class='footer'>
              Mongoid, 2009-2011, written and maintained by
              <a href="http://github.com/durran">Durran Jordan</a>.
            </div>
        <div class='clear'></div>
      </div>
    </div>
  </body>
</html>
